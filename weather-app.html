<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>WEATHER APP</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <style>
            [v-cloak] {display: none;}
            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;900&display=swap');
            #app {font-family: 'Poppins', sans-serif;}
            #app-title {font-size: 16px;}
            #location {font-size: 28px;}
            #date {font-size: 12px;}
            #temp {font-size: 48px; font-weight: bold}
            #weather {font-size: 16px}
            #min-max-temp {font-size: 12px; font-weight: lighter}
            #pressure-humidity {font-size: 12px}
            .custom-control-input:checked~.custom-control-label::before {
                color: #fff;
                border-color: #878787;
                background-color: #878787;
            }
            /* Dark Mode */
            .dark .card, .dark .form-control{
                background-color: #1D1D1D!important;
                color: #878787;
            }
            .dark .custom-control-label{
                color: #878787;
            }
            .dark .bg-light{
                background-color: #121212!important;
            }

        </style>
    </head>
    <body class="bg-light">
    <div id="app" v-cloak="display-none">
        <h1 id="app-title" class="text-center mt-5 mb-5">WEATHER APP</h1>
        <div class="container col-lg-4 mt-5 mb-5">
            <form class="form-inline mx auto justify-content-md-center" v-on:submit.prevent="fetchWeather">
                <input v-model="query" class="form-control shadow-sm" style="border: none; min-width: 50%; border-radius: 10px" type="search" placeholder="Recherchez une ville..." aria-label="Search" @keypress="fetchWeather"/>
            </form>
        </div>
        <div class="container col-lg-3">
            <div class="card text-center shadow-sm bg-white" style="border: none; border-radius: 10px" v-if="typeof weather.main != 'undefined'">
                <div id="weather-box" class="card-body bg-transparent">
                    <div class="card-title">
                        <div id="weather" style="text-transform: uppercase; margin-bottom: 1.5em">{{ weather.weather[0].description }}</div>
                        <div id="temp">{{ Math.round(weather.main.temp) }}°C</div>
                        <div id="min-max-temp">Min : {{ Math.round(weather.main.temp_min) }}°C / Max : {{ Math.round(weather.main.temp_max) }}°C</div>
                        <h2 id="location" style="margin-top: 1.5em">{{ weather.name }}</h2>
                        <span id="date" class="card-text">{{ dateBuilder() }}</span>
                    </div>
                </div>
                <div class="card-footer bg-light" style="border: none">
                    <div id="pressure-humidity">Pression : {{ Math.round(weather.main.pressure) }} hPa - Humidité : {{ Math.round(weather.main.humidity) }}%</div>
                </div>
            </div>
        </div>
        <div class="container col-lg-3 text-center mt-5">
            <div class="custom-control custom-switch">
                <input type="checkbox" class="custom-control-input" id="customSwitches">
                <label class="custom-control-label" for="customSwitches">Light/Dark mode</label>
            </div>
        </div>
    </div>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script>
            new Vue({
                el: '#app',
                data () {
                    return {
                        api_key: 'c4233ddd3db902ec1fd95cfe611121ec',
                        url_base: 'https://api.openweathermap.org/data/2.5/',
                        query: '',
                        weather: {},
                    }
                },
                methods: {
                    fetchWeather (e) {
                        if (e.key === "Enter") {
                            fetch(`${this.url_base}weather?q=${this.query}&units=metric&lang=fr&APPID=${this.api_key}`)
                                .then(res => {
                                    return res.json();
                                }).then(this.setResults);
                        }
                    },
                    setResults (results){
                        this.weather = results;
                    },
                    dateBuilder () {
                        let d = new Date();
                        let months = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];
                        let days = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"];

                        let day = days[d.getDay()];
                        let date = d.getDate();
                        let month = months[d.getMonth()];

                        return `${day} ${date} ${month}`
                    },
                }
            })
        </script>
    </body>    
</html>